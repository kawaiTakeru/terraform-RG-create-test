trigger: none
pr: none

pool:
  name: Default

variables:
  - name: System.Debug
    value: 'true'

steps:
- task: PowerShell@2
  displayName: 'Slack通知テスト（変数参照）'
  condition: always()
  env:
    SLACK_WEBHOOK_URL: $(SLACK_WEBHOOK_URL)  # 明示的に環境変数として渡す
  inputs:
    targetType: 'inline'
    script: |
      $webhookUrl = "${env:SLACK_WEBHOOK_URL}"
      Write-Host "DEBUG: Webhook URL = [$webhookUrl]"

      $payload = @{ text = "✅ 通知テスト 変数OK✅" } | ConvertTo-Json
      Write-Host "DEBUG: Payload JSON = $payload"

      $response = Invoke-RestMethod `
        -Uri $webhookUrl `
        -Method POST `
        -Body $payload `
        -ContentType 'application/json' `
        -ErrorAction Stop

      Write-Host "DEBUG: Slack response = $response"
