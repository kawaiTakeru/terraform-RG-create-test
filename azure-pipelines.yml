trigger: none

pool:
  name: Default  # Self-hosted Agent Pool 名（"Default"で正しいはず）
  demands:
    - agent.name -equals LAPTOP-OEOER8OI  # 自分のPC名

steps:
  - checkout: self

  - task: PowerShell@2
    displayName: 'Step 1: Terraform Init'
    inputs:
      targetType: 'inline'
      script: |
        Write-Host "🔧 Terraform Init 開始"
        terraform init

  - task: PowerShell@2
    displayName: 'Step 2: Terraform Plan'
    inputs:
      targetType: 'inline'
      script: |
        Write-Host "📋 Terraform Plan 開始"
        terraform plan

  - task: PowerShell@2
    displayName: 'Step 3: Terraform Apply'
    inputs:
      targetType: 'inline'
      script: |
        Write-Host "🚀 Terraform Apply 開始"
        terraform apply -auto-approve
