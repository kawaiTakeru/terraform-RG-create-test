trigger:
  - none
  
pool:
  name: Default  # Self-hosted Agent

steps:
# Terraform ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
- task: PowerShell@2
  displayName: 'Check Terraform Version'
  inputs:
    targetType: 'inline'
    script: |
      terraform -version
      Write-Host "â€» Terraform Version ãŒ ${env:TF_VERSION} ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª"

# Terraform Init
- task: PowerShell@2
  displayName: 'Step 1: Terraform Init'
  inputs:
    targetType: 'inline'
    script: |
      Write-Host "ğŸ“Œ Terraform Init é–‹å§‹"
      terraform init

# Terraform Plan
- task: PowerShell@2
  displayName: 'Step 2: Terraform Plan'
  inputs:
    targetType: 'inline'
    script: |
      Write-Host "ğŸ“‹ Terraform Plan é–‹å§‹"
      terraform plan -out=tfplan

# Terraform Apply
- task: PowerShell@2
  displayName: 'Step 3: Terraform Apply'
  inputs:
    targetType: 'inline'
    script: |
      Write-Host "ğŸš€ Terraform Apply é–‹å§‹"
      terraform apply -auto-approve tfplan
