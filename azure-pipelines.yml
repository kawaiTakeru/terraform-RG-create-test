trigger:
  - none

pool:
  name: Default  # Self-hosted Agent

steps:
- task: PowerShell@2
  displayName: 'Step 3: Terraform Apply'
  continueOnError: true
  inputs:
    targetType: 'inline'
    script: |
      Write-Host "ðŸš€ Terraform Apply é–‹å§‹"
      terraform apply -auto-approve tfplan
      Write-Host "â†’ Terraform Apply çµ‚äº†ã‚³ãƒ¼ãƒ‰: $LASTEXITCODE"
      if ($LASTEXITCODE -ne 0) {
        Write-Error "ERROR: Terraform Apply failed with code $LASTEXITCODE"
        exit 1
      }

- task: PowerShell@2
  displayName: 'Slacké€šçŸ¥ï¼ˆãƒ‡ãƒãƒƒã‚°ç‰ˆï¼‰'
  condition: failed()
  inputs:
    targetType: 'filePath'
    filePath: 'scripts/notify-slack.ps1'
    arguments: >
      -webhookUrl https://hooks.slack.com/services/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
      -pipelineName "$(Build.DefinitionName)"
      -buildId "$(Build.BuildId)"
      -projectName "$(System.TeamProject)"
